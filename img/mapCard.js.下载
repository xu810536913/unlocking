M.map.MapCard=function(b){var a=this;a.container=b.container;a.control=new BMap.NavigationControl();a.map;a.marker;a.information;a.icon=new BMap.Icon("img/location.gif",new BMap.Size(14,23));if(b.center=="undefined"||b.center==null){a.point=new BMap.Point(116.404,39.915)}else{a.point=b.point}if(b.zoom=="undefined"||b.zoom==null){a.zoom=14}else{a.zoom=b.zoom}if(b.basicInformation=="undefined"||b.basicInformation==null){a.basicInformation=""}else{a.basicInformation=b.basicInformation}if(b.route=="undefined"||b.route==null){a.route=true}else{a.route=b.route}if(b.enableRouteSearchBox=="undefined"||b.enableRouteSearchBox==null){a.enableRouteSearchBox=true}else{a.enableRouteSearchBox=b.enableRouteSearchBox}if(b.mapSize=="undefined"||b.mapSize==null){a.mapSize=new BMap.Size(500,360)}else{a.mapSize=b.mapSize}a.init()};M.map.MapCard._callback={};M.map.MapCard.prototype={setInformation:function(b){var c=b.cardName;cardPhone=b.cardPhone;cardEmail=b.cardEmail;cardFax=b.cardFax;cardIntroduction=b.cardIntroduction;var a=baidu.dom.g("mapCard_name");mapCardPhone=baidu.dom.g("mapCard_phone");mapCardEmail=baidu.dom.g("mapCard_email");mapCardFax=baidu.dom.g("mapCard_fax");mapCardIntroduction=baidu.dom.g("mapCard_introduction");this.confilter(c,a);this.confilter(cardPhone,mapCardPhone);this.confilter(cardEmail,mapCardEmail);this.confilter(cardFax,mapCardFax);this.confilter(cardIntroduction,mapCardIntroduction)},setLocation:function(d){var a=d.province;city=d.city;borough=d.borough;address=d.address;var c=baidu.dom.g("mapCard_address");mapCardBus=baidu.dom.g("mapCard_way_bus");mapCardSubway=baidu.dom.g("mapCard_way_subway");var g="http://map.baidu.com/maps/services/confilter?";var e=[];e.push("q[]="+encodeURIComponent(address));var b=(Math.random()*100000).toFixed(0);M.map.MapCard._callback["_cbk"+b]=function(h){c.innerHTML="地址："+a+city+borough+M.map.MapCard.confilterCallback(h,address);delete M.map.MapCard._callback["_cbk"+b]};M.fe.scriptRequest({url:g+"&cb=M.map.MapCard._callback._cbk"+b+"&"+e.join("&")});var f=new BMap.Geocoder();setTimeout(function(){var h=window.CENTER_POINT;if(h!=null){var j={onSearchComplete:function(o){if(l.getStatus()==BMAP_STATUS_SUCCESS){var p=[];var m=o.getCurrentNumPois();var q=m>3?3:m;for(var n=0;n<q;n++){p.push(o.getPoi(n).title+"("+o.getPoi(n).address+")")}baidu.dom.g("mapCard_way_bus").innerHTML="公交："+p.join("<br/>")}}};var l=new BMap.LocalSearch(h,j);l.searchNearby("公交：",h,500);var i={onSearchComplete:function(o){if(k.getStatus()==BMAP_STATUS_SUCCESS){var p=[];for(var n=0;n<o.getCurrentNumPois();n++){var m=o.getPoi(n).address;if(m!=""&&m.indexOf("线")>0){p.push(o.getPoi(n).title+"("+m+")")}}baidu.dom.g("mapCard_way_subway").innerHTML="地铁："+p.join("<br/>")}}};var k=new BMap.LocalSearch(h,i);k.searchNearby("地铁：",h,1000)}else{mapCardBus.innerHTML="公交：暂无";mapCardSubway.innerHTML="地铁：暂无"}},700)},getZoom:function(){var a=this;return a.map.getZoom()},setZoom:function(b){var a=this;a.zoom=b;a.map.setZoom(b)},smallControl:function(){var b=this;var a={type:BMAP_NAVIGATION_CONTROL_SMALL};b.map.removeControl(b.control);b.control=new BMap.NavigationControl(a);b.map.addControl(b.control)},bigControl:function(){var b=this;var a={type:BMAP_NAVIGATION_CONTROL_LARGE};b.map.removeControl(b.control);b.control=new BMap.NavigationControl(a);b.map.addControl(b.control)},getCenter:function(){return this.point},setCenter:function(a){var c=this;window.setTimeout(function(){c.map.setCenter(a)},100);c.point=a;window.CENTER_POINT=a;c.setMAPCARD_NAME(a);c.map.removeOverlay(c.marker);c.marker=new BMap.Marker(a);c.marker.setIcon(c.icon);c.map.addOverlay(c.marker);c.cityCode=131;var b="http://api.map.baidu.com/geocoder?output=json&location="+c.point.lat+","+c.point.lng+"&key=cff3a9abc58e6aaaeb698dc7f07c5a1e";T.ajax.get(b,function(f,e){var d=T.json.decode(e);if(d.status="OK"){c.cityCode=d.result.cityCode}})},showBasicInformation:function(){var a=baidu.dom.g("mapCard_information");a.style.display="";this.basicInformation=true},hideBasicInformation:function(){var a=baidu.dom.g("mapCard_information");a.style.display="none";this.basicInformation=false},setBasicInformation:function(a){if(a=="false"){this.hideBasicInformation()}else{this.showBasicInformation()}},showRoute:function(){var a=baidu.dom.g("mapCard_way_information");a.style.display="";this.route=true},hideRoute:function(){var a=baidu.dom.g("mapCard_way_information");a.style.display="none";this.route=false},setRoute:function(a){if(a=="false"){this.hideRoute()}else{this.showRoute()}},showSearchBox:function(){var a=baidu.dom.g("search_mapCard");a.style.display="";this.enableRouteSearchBox=true},hideSearchBox:function(){var a=baidu.dom.g("search_mapCard");a.style.display="none";this.enableRouteSearchBox=false},setSearchBox:function(a){if(a=="false"){this.hideSearchBox()}else{this.showSearchBox()}},setSize:function(b,a){var d=this;var b=parseInt(b,10);var a=parseInt(a,10);var c=baidu.dom.g("mapCard_container");c.style.width=b+"px";c.style.height=a+"px"},openDialog:function(f){var e=this;var a=e.point;var b=encodeURIComponent(baidu.dom.g("mapCard_address").innerHTML);var d=baidu.dom.g("mapCard_name").innerHTML.split("：")[1];window._addStat(6159);var c="http://map.baidu.com/?latlng="+a.lat+","+a.lng+"&title="+d+"&content="+b;window.open(c,"newwindow","height=768,width=1024,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no")},setMAPCARD_NAME:function(a){var b=new BMap.Geocoder();b.getLocation(a,function(c){if(c!=null){window.MAPCARD_NAME=c.address}else{window.MAPCARD_NAME=""}})}};M.map.MapCard.prototype.init=function(d){var c=this;mapCard=baidu.dom.g(c.container);var a='<div id="mapCard_header">地图名片</div><div id="mapCard_body"><div id="mapCard_information"><div id="mapCard_name">名称：</div><div id="mapCard_address">地址：</div><div id="mapCard_phone">电话：</div><div id="mapCard_fax">传真号：</div><div id="mapCard_email">email:</div><div id="mapCard_introduction">简介：</div></div><div id="mapCard_container"></div><div id="mapCard_bigMap"><img src="img/bigMapIcon.jpg"/><a style="vertical-align:text-bottom;" href="" id="big_map">查看大图</a></div></div><div id="mapCard_footer"><div id="mapCard_way_information"><div id="mapCard_way_text">附近公交/地铁</div><div id="mapCard_way_bus">公交：</div><div id="mapCard_way_subway">地铁：</div></div><div id="search_mapCard"><div id="place_end" class="place_target_unselected place_target_selected"><img src="http://map.baidu.com/image/transparent.gif"/>到这里去</div><div id="place_start" class="place_target_unselected place_target_middle"><img src="http://map.baidu.com/image/transparent.gif"/>从这里来</div><div id="place_surrounding" class="place_target_unselected"><img src="http://map.baidu.com/image/transparent.gif"/>在附近找</div><div id="place_empty"></div><div id="search_place_input" style=""><label for="search_target" id="target_text">起点：</label><input type="text" id="search_target"/><span id="search_line_button"><input type="button" id="search_bus_button" value="公交"/><input type="button" id="search_drive_button" value="驾车"/></span></div><div id="search_place_surrounding" style="display:none;"><a href="javascript:void(0)">ATM</a><a href="javascript:void(0)">银行</a><a href="javascript:void(0)">宾馆</a><a href="javascript:void(0)">餐馆</a><a href="javascript:void(0)">公交站</a><input type="text" id="surrounding_target"><input type="button" id="search_surrounding_button" value="搜索"></div></div></div>';mapCard.innerHTML=a;var b=baidu.dom.g("mapCard_container");c.map=new BMap.Map(b);c.map.centerAndZoom(c.point,c.zoom);c.map.addControl(c.control);c.map.enableScrollWheelZoom();c.init2()};M.map.MapCard.prototype.init2=function(){var f=this;var e=baidu.dom.g("place_end");var h=baidu.dom.g("place_start");var b=baidu.dom.g("place_surrounding");var i=[];i.push(e,h,b);baidu.array.each(i,function(k){baidu.element(k).on("click",function(){baidu.array.each(i,function(p){baidu.dom.removeClass(p,"place_target_selected")});var o=this;if(o.id=="place_end"){var m=baidu.dom.g("search_place_input");var n=baidu.dom.g("search_place_surrounding");m.style.display="";n.style.display="none";var l=baidu.dom.g("target_text");l.innerHTML="起点："}else{if(o.id=="place_start"){var m=baidu.dom.g("search_place_input");var n=baidu.dom.g("search_place_surrounding");m.style.display="";n.style.display="none";var l=baidu.dom.g("target_text");l.innerHTML="终点："}else{var m=baidu.dom.g("search_place_input");var n=baidu.dom.g("search_place_surrounding");m.style.display="none";n.style.display=""}}baidu.dom.addClass(o,"place_target_selected")})});var g=baidu.dom.g("big_map");g.onclick=function(){f.openDialog(this);return false};var a=baidu.dom.g("search_bus_button");var c=baidu.dom.g("search_drive_button");a.onclick=function(){f.bus("bus")};c.onclick=function(){f.bus("drive")};var j=baidu.dom.g("search_place_surrounding").getElementsByTagName("a");baidu.array.each(j,function(k){baidu.element(k).on("click",function(){f.rangeSearchByLink(this)})});var d=baidu.dom.g("search_surrounding_button");d.onclick=function(){f.rangeSearchByLink()}};M.map.MapCard.prototype.rangeSearchByLink=function(g){var i=this;var m,f;if(g==null){m=T.string.trim(T.dom.g("surrounding_target").value);if(!T.string.trim(m)){T.dom.g("surrounding_target").focus();return}}else{m=T.string.trim(g.innerHTML)}var a="http://map.baidu.com/?";var e=[];var h=null;var c=new BMap.TileLayer();var d=new BMap.MapType("earth",c);var b=d.getProjection().lngLatToPoint(i.point);var k=b.x;var j=b.y;m=encodeURIComponent(m);f=15;h=["nb"];h.push("r=1000");h.push("c=");h.push("wd="+m);h.push("nbtp=0");h.push("nb_x="+k);h.push("nb_y="+j);h.push("l="+f);e.push("newmap=1");e.push("l="+f);e.push("tn=B_NORMAL_MAP");e.push("c="+k+","+j);e.push("i=-1|-1|-1");e.push("s="+encodeURIComponent(h.join("&")));window._addStat(6158);window.open(a+e.join("&"))};M.map.MapCard.prototype.bus=function(l){var k=this;var i=baidu.dom.g("search_target");var h=i.value;h=baidu.string.trim(h);var e=new BMap.TileLayer();var f=new BMap.MapType("earth",e);var c=f.getProjection().lngLatToPoint(k.point);var n=c.x;var m=c.y;var b=null;if(!h){i.focus();return}if(l=="bus"){var j="bse"}else{var j="nse"}var g=baidu.dom.g("target_text").innerHTML;if(g=="终点："){b="sn"}else{b="en"}if(j=="bse"){window._addStat(6155)}else{window._addStat(6157)}if(window.MAPCARD_NAME){var a=k.common(h,window.MAPCARD_NAME,j,b,n,m,k.cityCode);window.open(a)}else{window.open("http://map.baidu.com")}};M.map.MapCard.prototype.common=function(g,b,k,d,m,l,j){var f=encodeURIComponent(g);var e=[];var h=[k];var a="http://map.baidu.com/?";var i=function(o,c,n){o.push(c+"="+n)};i(h,"isSingle","true");if(d=="sn"){i(h,"t","1")}else{i(h,"t","0")}i(h,"uid","");i(h,"c",j);i(h,"ptx",m);i(h,"pty",l);i(h,"poiType","0");i(h,"sug","0");i(h,"wd2","");i(h,"req",k);i(h,"wd",g);i(h,"name",b);i(h,d,"1$$$$"+m+","+l+"$$"+b+"$$$$$$");i(h,"sy","0");i(e,"newmap","1");i(e,"tn","B_NORMAL_MAP");i(e,"s",encodeURIComponent(h.join("&")));return a+e.join("&")};M.map.MapCard.prototype.confilter=function(b,e){var d="http://map.baidu.com/maps/services/confilter?";var c="q[]="+encodeURIComponent(b);var a=(Math.random()*100000).toFixed(0);M.map.MapCard._callback["_cbk"+a]=function(f){if(e.id=="mapCard_name"){e.innerHTML="名称："+M.map.MapCard.confilterCallback(f,b)}else{if(e.id=="mapCard_phone"){e.innerHTML="电话："+M.map.MapCard.confilterCallback(f,b)}else{if(e.id=="mapCard_email"){e.innerHTML="email："+M.map.MapCard.confilterCallback(f,b)}else{if(e.id=="mapCard_fax"){e.innerHTML="传真号："+M.map.MapCard.confilterCallback(f,b)}else{e.innerHTML="简介："+M.map.MapCard.confilterCallback(f,b)}}}}delete M.map.MapCard._callback["_cbk"+a]};M.fe.scriptRequest({url:d+"&cb=M.map.MapCard._callback._cbk"+a+"&"+c})};M.map.MapCard.confilterCallback=function(a,b){if(a.result.error!=0){return""}if(a.content[0].words_count!=0){return""}else{return b}};